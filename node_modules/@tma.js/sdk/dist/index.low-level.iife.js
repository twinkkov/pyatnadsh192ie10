var Xe=Object.defineProperty;var ze=(i,f,l)=>f in i?Xe(i,f,{enumerable:!0,configurable:!0,writable:!0,value:l}):i[f]=l;var A=(i,f,l)=>ze(i,typeof f!="symbol"?f+"":f,l);this.tmajs=this.tmajs||{};this.tmajs.sdk=function(i){"use strict";function f(t,e){let r;const n=()=>{r!==void 0&&e&&e(r),r=void 0};return[()=>r===void 0?r=t(n):r,n]}function l(t){const e=R(),{count:r}=e;e.unsubscribe(t),r&&!e.count&&de()}function M(t){return R().subscribe(t),()=>l(t)}class re{constructor(e,r={}){this.scope=e,this.options=r}print(e,...r){const n=new Date,o=Intl.DateTimeFormat("en-GB",{hour:"2-digit",minute:"2-digit",second:"2-digit",fractionalSecondDigits:3,timeZone:"UTC"}).format(n),{textColor:s,bgColor:u}=this.options,a="font-weight: bold;padding: 0 5px;border-radius:5px";console[e](`%c${o}%c / %c${this.scope}`,`${a};background-color: lightblue;color:black`,"",`${a};${s?`color:${s};`:""}${u?`background-color:${u}`:""}`,...r)}error(...e){this.print("error",...e)}log(...e){this.print("log",...e)}}const P=new re("SDK",{bgColor:"forestgreen",textColor:"white"});let I=!1;const U=({name:t,payload:e})=>{P.log("Event received:",e?{name:t,payload:e}:{name:t})};function ne(t){I!==t&&(I=t,t?M(U):l(U))}function oe(...t){I&&P.log(...t)}class L{constructor(){A(this,"listeners",new Map);A(this,"listenersCount",0);A(this,"subscribeListeners",[])}clear(){this.listeners.clear(),this.subscribeListeners=[]}get count(){return this.listenersCount+this.subscribeListeners.length}emit(e,...r){this.subscribeListeners.forEach(o=>o({event:e,args:r})),(this.listeners.get(e)||[]).forEach(([o,s])=>{o(...r),s&&this.off(e,o)})}on(e,r,n){let o=this.listeners.get(e);return o||this.listeners.set(e,o=[]),o.push([r,n]),this.listenersCount+=1,()=>this.off(e,r)}off(e,r){const n=this.listeners.get(e)||[];for(let o=0;o<n.length;o+=1)if(r===n[o][0]){n.splice(o,1),this.listenersCount-=1;return}}subscribe(e){return this.subscribeListeners.push(e),()=>this.unsubscribe(e)}unsubscribe(e){for(let r=0;r<this.subscribeListeners.length;r+=1)if(this.subscribeListeners[r]===e){this.subscribeListeners.splice(r,1);return}}}function W(t,e,r){return window.addEventListener(t,e,r),()=>window.removeEventListener(t,e,r)}function C(...t){let e=!1;const r=t.flat(1);return[n=>!e&&r.push(n),()=>{e||(e=!0,r.forEach(n=>n()))},e]}class E extends Error{constructor(e,r,n){super(r,{cause:n}),this.type=e,Object.setPrototypeOf(this,E.prototype)}}function m(t,e,r){return new E(t,e,r)}const V="ERR_METHOD_UNSUPPORTED",$="ERR_METHOD_PARAMETER_UNSUPPORTED",G="ERR_UNKNOWN_ENV",k="ERR_INVOKE_CUSTOM_METHOD_RESPONSE",q="ERR_TIMED_OUT",H="ERR_UNEXPECTED_TYPE",N="ERR_PARSE",ie="ERR_NAVIGATION_LIST_EMPTY",se="ERR_NAVIGATION_CURSOR_INVALID",ae="ERR_NAVIGATION_ITEM_INVALID",ce="ERR_SSR_INIT",ue="ERR_INVALID_PATH_BASE";function w(){return m(H,"Value has unexpected type")}class S{constructor(e,r,n){this.parser=e,this.isOptional=r,this.type=n}parse(e){if(!(this.isOptional&&e===void 0))try{return this.parser(e)}catch(r){throw m(N,`Unable to parse value${this.type?` as ${this.type}`:""}`,r)}}optional(){return this.isOptional=!0,this}}function d(t,e){return()=>new S(t,!1,e)}const b=d(t=>{if(typeof t=="boolean")return t;const e=String(t);if(e==="1"||e==="true")return!0;if(e==="0"||e==="false")return!1;throw w()},"boolean");function j(t,e){const r={};for(const n in t){const o=t[n];if(!o)continue;let s,u;if(typeof o=="function"||"parse"in o)s=n,u=typeof o=="function"?o:o.parse.bind(o);else{const{type:a}=o;s=o.from||n,u=typeof a=="function"?a:a.parse.bind(a)}try{const a=u(e(s));a!==void 0&&(r[n]=a)}catch(a){throw m(N,`Unable to parse field "${n}"`,a)}}return r}function B(t){let e=t;if(typeof e=="string"&&(e=JSON.parse(e)),typeof e!="object"||e===null||Array.isArray(e))throw w();return e}function h(t,e){return new S(r=>{const n=B(r);return j(t,o=>n[o])},!1,e)}const g=d(t=>{if(typeof t=="number")return t;if(typeof t=="string"){const e=Number(t);if(!Number.isNaN(e))return e}throw w()},"number"),c=d(t=>{if(typeof t=="string"||typeof t=="number")return t.toString();throw w()},"string");function pe(t){return h({eventType:c(),eventData:e=>e}).parse(t)}function _e(){["TelegramGameProxy_receiveEvent","TelegramGameProxy","Telegram"].forEach(t=>{delete window[t]})}function fe(t,e){window.dispatchEvent(new MessageEvent("message",{data:JSON.stringify({eventType:t,eventData:e}),source:window.parent}))}function le(){[["TelegramGameProxy_receiveEvent"],["TelegramGameProxy","receiveEvent"],["Telegram","WebView","receiveEvent"]].forEach(t=>{let e=window;t.forEach((r,n,o)=>{if(n===o.length-1){e[r]=fe;return}r in e||(e[r]={}),e=e[r]})})}const me={clipboard_text_received:h({req_id:c(),data:t=>t===null?t:c().optional().parse(t)}),custom_method_invoked:h({req_id:c(),result:t=>t,error:c().optional()}),popup_closed:{parse(t){return h({button_id:e=>e==null?void 0:c().parse(e)}).parse(t??{})}},viewport_changed:h({height:g(),width:t=>t==null?window.innerWidth:g().parse(t),is_state_stable:b(),is_expanded:b()})};function be(){const t=new L,e=new L;e.subscribe(n=>{t.emit("event",{name:n.event,payload:n.args[0]})}),le();const[,r]=C(_e,W("resize",()=>{e.emit("viewport_changed",{width:window.innerWidth,height:window.innerHeight,is_state_stable:!0,is_expanded:!0})}),W("message",n=>{if(n.source!==window.parent)return;let o;try{o=pe(n.data)}catch{return}const{eventType:s,eventData:u}=o,a=me[s];try{const p=a?a.parse(u):u;e.emit(...p?[s,p]:[s])}catch(p){P.error(`An error occurred processing the "${s}" event from the Telegram application.
Please, file an issue here:
https://github.com/Telegram-Mini-Apps/tma.js/issues/new/choose`,o,p)}}),()=>t.clear(),()=>e.clear());return[{on:e.on.bind(e),off:e.off.bind(e),subscribe(n){return t.on("event",n)},unsubscribe(n){t.off("event",n)},get count(){return e.count+t.count}},r]}const[he,de]=f(t=>{const[e,r]=be(),n=e.off.bind(e);return e.off=(o,s)=>{const{count:u}=e;n(o,s),u&&!e.count&&t()},[e,r]},([,t])=>t());function R(){return he()[0]}function ge(t,e){R().off(t,e)}function T(t,e,r){return R().on(t,e,r)}function v(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function Ee(t,e){const r=t.split("."),n=e.split("."),o=Math.max(r.length,n.length);for(let s=0;s<o;s+=1){const u=parseInt(r[s]||"0",10),a=parseInt(n[s]||"0",10);if(u!==a)return u>a?1:-1}return 0}function _(t,e){return Ee(t,e)<=0}function D(t,e,r){if(typeof r=="string"){if(t==="web_app_open_link"){if(e==="try_instant_view")return _("6.4",r);if(e==="try_browser")return _("7.6",r)}if(t==="web_app_set_header_color"&&e==="color")return _("6.9",r);if(t==="web_app_close"&&e==="return_back")return _("7.6",r)}switch(t){case"web_app_open_tg_link":case"web_app_open_invoice":case"web_app_setup_back_button":case"web_app_set_background_color":case"web_app_set_header_color":case"web_app_trigger_haptic_feedback":return _("6.1",e);case"web_app_open_popup":return _("6.2",e);case"web_app_close_scan_qr_popup":case"web_app_open_scan_qr_popup":case"web_app_read_text_from_clipboard":return _("6.4",e);case"web_app_switch_inline_query":return _("6.7",e);case"web_app_invoke_custom_method":case"web_app_request_write_access":case"web_app_request_phone":return _("6.9",e);case"web_app_setup_settings_button":return _("6.10",e);case"web_app_biometry_get_info":case"web_app_biometry_open_settings":case"web_app_biometry_request_access":case"web_app_biometry_request_auth":case"web_app_biometry_update_token":return _("7.2",e);default:return["iframe_ready","iframe_will_reload","web_app_close","web_app_data_send","web_app_expand","web_app_open_link","web_app_ready","web_app_request_theme","web_app_request_viewport","web_app_setup_main_button","web_app_setup_closing_behavior"].includes(t)}}function we(t){return"external"in t&&v(t.external)&&"notify"in t.external&&typeof t.external.notify=="function"}function K(t){return"TelegramWebviewProxy"in t&&v(t.TelegramWebviewProxy)&&"postEvent"in t.TelegramWebviewProxy&&typeof t.TelegramWebviewProxy.postEvent=="function"}function Y(){try{return window.self!==window.top}catch{return!0}}let J="https://web.telegram.org";function ye(t){J=t}function F(){return J}function y(t,e,r){let n={},o;if(!e&&!r?n={}:e&&r?(n=r,o=e):e&&("targetOrigin"in e?n=e:o=e),oe("Posting event:",o?{event:t,data:o}:{event:t}),Y())return window.parent.postMessage(JSON.stringify({eventType:t,eventData:o}),n.targetOrigin||F());if(we(window)){window.external.notify(JSON.stringify({eventType:t,eventData:o}));return}if(K(window)){window.TelegramWebviewProxy.postEvent(t,JSON.stringify(o));return}throw m(G,"Unable to determine current environment and possible way to send event. You are probably trying to use Mini Apps method outside the Telegram application environment.")}function Re(t){return(e,r)=>{if(!D(e,t))throw m(V,`Method "${e}" is unsupported in Mini Apps version ${t}`);if(v(r)&&e==="web_app_set_header_color"&&"color"in r&&!D(e,"color",t))throw m($,`Parameter "color" of "${e}" method is unsupported in Mini Apps version ${t}`);return y(e,r)}}function X(t){return({req_id:e})=>e===t}function Te(t){return m(q,`Timeout reached: ${t}ms`)}function Ae(t,e){return Promise.race([typeof t=="function"?t():t,new Promise((r,n)=>{setTimeout(()=>{n(Te(e))},e)})])}async function O(t){let e;const r=new Promise(a=>e=a),{event:n,capture:o,timeout:s}=t,[,u]=C((Array.isArray(n)?n:[n]).map(a=>T(a,p=>{(!o||(Array.isArray(n)?o({event:a,payload:p}):o(p)))&&e(p)})));try{return(t.postEvent||y)(t.method,t.params),await(s?Ae(r,s):r)}finally{u()}}async function Pe(t,e,r,n={}){const{result:o,error:s}=await O({...n,method:"web_app_invoke_custom_method",event:"custom_method_invoked",params:{method:t,params:e,req_id:r},capture:X(r)});if(s)throw m(k,s);return o}async function Ie(){if(K(window))return!0;try{return await O({method:"web_app_request_theme",event:"theme_changed",timeout:100}),!0}catch{return!1}}function z(t){return t instanceof E}function Ne(t,e){return z(t)&&t.type===e}function Se(t=!0){const e=[T("reload_iframe",()=>{y("iframe_will_reload"),window.location.reload()})],r=()=>e.forEach(n=>n());if(t){const n=document.createElement("style");n.id="telegram-custom-styles",document.head.appendChild(n),e.push(T("set_custom_style",o=>{n.innerHTML=o}),()=>document.head.removeChild(n))}return y("iframe_ready",{reload_supported:!0}),r}const ve=d(t=>t instanceof Date?t:new Date(g().parse(t)*1e3),"Date");function Z(t,e){return new S(r=>{if(typeof r!="string"&&!(r instanceof URLSearchParams))throw w();const n=typeof r=="string"?new URLSearchParams(r):r;return j(t,o=>{const s=n.get(o);return s===null?void 0:s})},!1,e)}const De=h({id:g(),type:c(),title:c(),photoUrl:{type:c().optional(),from:"photo_url"},username:c().optional()},"Chat").optional(),Q=h({addedToAttachmentMenu:{type:b().optional(),from:"added_to_attachment_menu"},allowsWriteToPm:{type:b().optional(),from:"allows_write_to_pm"},firstName:{type:c(),from:"first_name"},id:g(),isBot:{type:b().optional(),from:"is_bot"},isPremium:{type:b().optional(),from:"is_premium"},languageCode:{type:c().optional(),from:"language_code"},lastName:{type:c().optional(),from:"last_name"},photoUrl:{type:c().optional(),from:"photo_url"},username:c().optional()},"User").optional();function Oe(){return Z({authDate:{type:ve(),from:"auth_date"},canSendAfter:{type:g().optional(),from:"can_send_after"},chat:De,chatInstance:{type:c().optional(),from:"chat_instance"},chatType:{type:c().optional(),from:"chat_type"},hash:c(),queryId:{type:c().optional(),from:"query_id"},receiver:Q,startParam:{type:c().optional(),from:"start_param"},user:Q},"InitData")}function Me(t){return/^#[\da-f]{6}$/i.test(t)}function Ue(t){return/^#[\da-f]{3}$/i.test(t)}function Le(t){const e=t.replace(/\s/g,"").toLowerCase();if(Me(e))return e;if(Ue(e)){let n="#";for(let o=0;o<3;o+=1)n+=e[1+o].repeat(2);return n}const r=e.match(/^rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)$/)||e.match(/^rgba\((\d{1,3}),(\d{1,3}),(\d{1,3}),\d{1,3}\)$/);if(!r)throw new Error(`Value "${t}" does not satisfy any of known RGB formats.`);return r.slice(1).reduce((n,o)=>{const s=parseInt(o,10).toString(16);return n+(s.length===1?"0":"")+s},"#")}const We=d(t=>Le(c().parse(t)),"rgb");function Ce(t){return t.replace(/_[a-z]/g,e=>e[1].toUpperCase())}function Ve(t){return t.replace(/[A-Z]/g,e=>`_${e.toLowerCase()}`)}const $e=d(t=>{const e=We().optional();return Object.entries(B(t)).reduce((r,[n,o])=>(r[Ce(n)]=e.parse(o),r),{})},"ThemeParams");function x(t){return Z({botInline:{type:b().optional(),from:"tgWebAppBotInline"},initData:{type:Oe().optional(),from:"tgWebAppData"},initDataRaw:{type:c().optional(),from:"tgWebAppData"},platform:{type:c(),from:"tgWebAppPlatform"},showSettings:{type:b().optional(),from:"tgWebAppShowSettings"},startParam:{type:c().optional(),from:"tgWebAppStartParam"},themeParams:{type:$e(),from:"tgWebAppThemeParams"},version:{type:c(),from:"tgWebAppVersion"}}).parse(t)}function ee(t){return x(t.replace(/^[^?#]*[?#]/,"").replace(/[?#]/g,"&"))}function Ge(){return ee(window.location.href)}function ke(){return performance.getEntriesByType("navigation")[0]}function qe(){const t=ke();if(!t)throw new Error("Unable to get first navigation entry.");return ee(t.name)}function te(t){return`tma.js/${t.replace(/[A-Z]/g,e=>`-${e.toLowerCase()}`)}`}function He(t,e){sessionStorage.setItem(te(t),JSON.stringify(e))}function je(t){const e=sessionStorage.getItem(te(t));try{return e?JSON.parse(e):void 0}catch{}}function Be(){return x(je("launchParams")||"")}function Ke(t){return JSON.stringify(Object.fromEntries(Object.entries(t).map(([e,r])=>[Ve(e),r])))}function Ye(t){const{initDataRaw:e,themeParams:r,platform:n,version:o,showSettings:s,startParam:u,botInline:a}=t,p=new URLSearchParams;return p.set("tgWebAppPlatform",n),p.set("tgWebAppThemeParams",Ke(r)),p.set("tgWebAppVersion",o),e&&p.set("tgWebAppData",e),u&&p.set("tgWebAppStartParam",u),typeof s=="boolean"&&p.set("tgWebAppShowSettings",s?"1":"0"),typeof a=="boolean"&&p.set("tgWebAppBotInline",a?"1":"0"),p.toString()}function Je(t){He("launchParams",Ye(t))}function Fe(){for(const t of[Ge,qe,Be])try{const e=t();return Je(e),e}catch{}throw new Error("Unable to retrieve launch parameters from any known source.")}return i.ERR_INVALID_PATH_BASE=ue,i.ERR_INVOKE_CUSTOM_METHOD_RESPONSE=k,i.ERR_METHOD_PARAMETER_UNSUPPORTED=$,i.ERR_METHOD_UNSUPPORTED=V,i.ERR_NAVIGATION_HISTORY_EMPTY=ie,i.ERR_NAVIGATION_INDEX_INVALID=se,i.ERR_NAVIGATION_ITEM_INVALID=ae,i.ERR_PARSE=N,i.ERR_SSR_INIT=ce,i.ERR_TIMED_OUT=q,i.ERR_UNEXPECTED_TYPE=H,i.ERR_UNKNOWN_ENV=G,i.SDKError=E,i.captureSameReq=X,i.createPostEvent=Re,i.initWeb=Se,i.invokeCustomMethod=Pe,i.isIframe=Y,i.isSDKError=z,i.isSDKErrorOfType=Ne,i.isTMA=Ie,i.off=ge,i.on=T,i.postEvent=y,i.request=O,i.retrieveLaunchParams=Fe,i.setDebug=ne,i.setTargetOrigin=ye,i.subscribe=M,i.supports=D,i.targetOrigin=F,i.unsubscribe=l,Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),i}({});
//# sourceMappingURL=index.low-level.iife.js.map
